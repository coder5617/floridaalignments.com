{% extends "base.html" %}

{% block title %}Contact Us - Get Free Auto Repair Quote - {{ business_name }}{% endblock %}

{% block description %}Get a free quote for auto repair services in Tampa. Contact Florida Alignment & Suspension for brake service, alignments, DOT inspections, and more. Call {{ business_phone }}.{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="contact-hero bg-primary text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8 mx-auto text-center">
                <h1 class="display-4 fw-bold mb-3">Get Your Free Quote Today</h1>
                <p class="lead mb-4">Professional automotive repair services in Tampa. We respond to all inquiries within 24 hours.</p>
                <div class="contact-stats row text-center mt-4">
                    <div class="col-md-4 mb-3">
                        <i class="fas fa-clock fa-2x text-warning mb-2"></i>
                        <div>24-Hour Response</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <i class="fas fa-shield-alt fa-2x text-warning mb-2"></i>
                        <div>Licensed & Insured</div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <i class="fas fa-tools fa-2x text-warning mb-2"></i>
                        <div>Expert Service</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="contact-form-section py-5">
    <div class="container">
        <div class="row">
            <!-- Contact Form -->
            <div class="col-lg-8 mb-5">
                <div class="card shadow-lg border-0 rounded-4">
                    <div class="card-header bg-primary text-white text-center py-4 rounded-top-4">
                        <h3 class="mb-0">
                            <i class="fas fa-comment-alt me-2"></i>
                            Request Your Free Quote
                        </h3>
                        <p class="mb-0 mt-2 opacity-75">Fill out the form below and we'll get back to you quickly</p>
                    </div>
                    <div class="card-body p-4">
                        <form id="contact-form" method="POST" class="needs-validation" novalidate>
                            {{ contact_form.hidden_tag() }}
                            
                            <!-- Personal Information -->
                            <div class="form-section mb-4">
                                <h5 class="form-section-title">
                                    <i class="fas fa-user text-primary me-2"></i>
                                    Your Information
                                </h5>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        {{ contact_form.name.label(class="form-label required") }}
                                        {{ contact_form.name(class="form-control form-control-lg", placeholder="Your full name") }}
                                        <div class="invalid-feedback"></div>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ contact_form.email.label(class="form-label required") }}
                                        {{ contact_form.email(class="form-control form-control-lg", placeholder="your.email@example.com") }}
                                        <div class="invalid-feedback"></div>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        {{ contact_form.phone.label(class="form-label") }}
                                        {{ contact_form.phone(class="form-control form-control-lg", placeholder="(555) 123-4567") }}
                                        <div class="invalid-feedback"></div>
                                        <small class="form-text text-muted">Optional - helps us respond faster</small>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ contact_form.urgency.label(class="form-label") }}
                                        {{ contact_form.urgency(class="form-select form-select-lg") }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Service Information -->
                            <div class="form-section mb-4">
                                <h5 class="form-section-title">
                                    <i class="fas fa-wrench text-primary me-2"></i>
                                    Service Details
                                </h5>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        {{ contact_form.service_id.label(class="form-label") }}
                                        {{ contact_form.service_id(class="form-select form-select-lg") }}
                                        <small class="form-text text-muted">Select the service you're interested in</small>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        {{ contact_form.subject.label(class="form-label") }}
                                        {{ contact_form.subject(class="form-control form-control-lg", placeholder="Brief description of your needs") }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Vehicle Information -->
                            <div class="form-section mb-4">
                                <h5 class="form-section-title">
                                    <i class="fas fa-car text-primary me-2"></i>
                                    Vehicle Information
                                    <small class="text-muted">(Optional)</small>
                                </h5>
                                <div class="row">
                                    <div class="col-md-4 mb-3">
                                        {{ contact_form.vehicle_year.label(class="form-label") }}
                                        {{ contact_form.vehicle_year(class="form-control form-control-lg", placeholder="2020") }}
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        {{ contact_form.vehicle_make.label(class="form-label") }}
                                        {{ contact_form.vehicle_make(class="form-control form-control-lg", placeholder="Honda") }}
                                    </div>
                                    <div class="col-md-4 mb-3">
                                        {{ contact_form.vehicle_model.label(class="form-label") }}
                                        {{ contact_form.vehicle_model(class="form-control form-control-lg", placeholder="Accord") }}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Message -->
                            <div class="form-section mb-4">
                                <h5 class="form-section-title">
                                    <i class="fas fa-comment text-primary me-2"></i>
                                    Tell Us More
                                </h5>
                                {{ contact_form.message.label(class="form-label required") }}
                                {{ contact_form.message(class="form-control form-control-lg", rows="5", placeholder="Please describe the issue you're experiencing or the service you need. The more details you provide, the better we can help you.") }}
                                <div class="invalid-feedback"></div>
                                <small class="form-text text-muted">Include any symptoms, noises, or specific concerns</small>
                            </div>
                            
                            <!-- Submit Button -->
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary btn-lg px-5 py-3">
                                    <i class="fas fa-paper-plane me-2"></i>
                                    Send My Request
                                </button>
                                <p class="mt-3 mb-0">
                                    <small class="text-muted">
                                        <i class="fas fa-shield-alt me-1"></i>
                                        Your information is secure and will never be shared
                                    </small>
                                </p>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <!-- Contact Information -->
            <div class="col-lg-4">
                <!-- Contact Info Card -->
                <div class="card shadow border-0 rounded-4 mb-4">
                    <div class="card-header bg-warning text-dark text-center py-3">
                        <h5 class="mb-0">
                            <i class="fas fa-phone me-2"></i>
                            Contact Information
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="contact-item mb-3">
                            <div class="d-flex align-items-center">
                                <div class="contact-icon">
                                    <i class="fas fa-phone text-primary"></i>
                                </div>
                                <div>
                                    <strong>Phone</strong><br>
                                    <a href="tel:{{ business_phone }}" class="text-decoration-none">{{ business_phone }}</a>
                                </div>
                            </div>
                        </div>
                        
                        <div class="contact-item mb-3">
                            <div class="d-flex align-items-center">
                                <div class="contact-icon">
                                    <i class="fas fa-envelope text-primary"></i>
                                </div>
                                <div>
                                    <strong>Email</strong><br>
                                    <a href="mailto:{{ business_email }}" class="text-decoration-none">{{ business_email }}</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Hours Card -->
                <div class="card shadow border-0 rounded-4 mb-4">
                    <div class="card-header bg-warning text-dark text-center py-3">
                        <h5 class="mb-0">
                            <i class="fas fa-clock me-2"></i>
                            Business Hours
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        <div class="hours-item d-flex justify-content-between mb-2">
                            <span><strong>Monday - Saturday</strong></span>
                            <span>8:00 AM - 6:00 PM</span>
                        </div>
                        <div class="hours-item d-flex justify-content-between mb-2">
                            <span><strong>Sunday</strong></span>
                            <span>Emergency Only</span>
                        </div>
                        <hr>
                        <p class="mb-0 text-center">
                            <small>
                                <i class="fas fa-exclamation-circle text-warning me-1"></i>
                                <strong>24/7 Emergency Service Available</strong><br>
                                <span class="text-muted">After 6:00 PM and Sundays considered emergency service</span>
                            </small>
                        </p>
                    </div>
                </div>
                
                <!-- FAQ Preview -->
                {% if faqs %}
                <div class="card shadow border-0 rounded-4">
                    <div class="card-header bg-info text-white text-center py-3">
                        <h5 class="mb-0">
                            <i class="fas fa-question-circle me-2"></i>
                            Common Questions
                        </h5>
                    </div>
                    <div class="card-body p-4">
                        {% for faq in faqs[:3] %}
                        <div class="faq-item mb-3">
                            <h6 class="text-primary mb-1">{{ faq.question }}</h6>
                            <p class="small text-muted mb-2">{{ faq.answer[:100] }}...</p>
                        </div>
                        {% if not loop.last %}<hr>{% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<!-- Leaflet CSS -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" 
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" 
    crossorigin=""/>
<!-- Leaflet JavaScript -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" 
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" 
    crossorigin=""></script>

<script>
// Enhanced contact form functionality with mailto
document.addEventListener('DOMContentLoaded', function() {
    const contactForm = document.getElementById('contact-form');
    
    if (contactForm) {
        contactForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Validate form
            if (!validateContactForm()) {
                return;
            }
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            // Show loading state
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Opening Email Client...';
            submitBtn.disabled = true;
            
            try {
                const formData = new FormData(this);
                
                // Extract form values
                const name = formData.get('name') || '';
                const email = formData.get('email') || '';
                const phone = formData.get('phone') || 'Not provided';
                const serviceId = formData.get('service_id') || '';
                const subject = formData.get('subject') || 'General Inquiry';
                const message = formData.get('message') || '';
                const vehicleYear = formData.get('vehicle_year') || '';
                const vehicleMake = formData.get('vehicle_make') || '';
                const vehicleModel = formData.get('vehicle_model') || '';
                const urgency = formData.get('urgency') || 'normal';
                
                // Get service name from the select element
                const serviceSelect = this.querySelector('[name="service_id"]');
                const serviceName = serviceSelect ? serviceSelect.options[serviceSelect.selectedIndex].text : 'General Inquiry';
                
                // Build vehicle info string
                const vehicleParts = [vehicleYear, vehicleMake, vehicleModel].filter(v => v);
                const vehicleInfo = vehicleParts.length > 0 ? vehicleParts.join(' ') : 'Not specified';
                
                // Build email body
                let emailBody = `Hello,\n\n`;
                emailBody += `My name is ${name} and I would like to request service information.\n\n`;
                emailBody += `CONTACT INFORMATION:\n`;
                emailBody += `- Name: ${name}\n`;
                emailBody += `- Email: ${email}\n`;
                emailBody += `- Phone: ${phone}\n\n`;
                emailBody += `SERVICE DETAILS:\n`;
                emailBody += `- Service Requested: ${serviceName}\n`;
                emailBody += `- Vehicle: ${vehicleInfo}\n`;
                emailBody += `- Urgency: ${urgency.toUpperCase()}\n`;
                emailBody += `- Subject: ${subject}\n\n`;
                emailBody += `MESSAGE:\n${message}\n\n`;
                emailBody += `---\nSent from Florida Alignment & Suspension website contact form`;
                
                // Build mailto URL
                const mailtoSubject = urgency === 'urgent' || urgency === 'asap' 
                    ? `ðŸš¨ URGENT - ${serviceName} Request from ${name}`
                    : `${serviceName} Request from ${name}`;
                
                const mailtoUrl = `mailto:service@floridaalignments.com?subject=${encodeURIComponent(mailtoSubject)}&body=${encodeURIComponent(emailBody)}`;
                
                // Track form submission
                if (window.FloridaAlignment && window.FloridaAlignment.trackContactFormSubmission) {
                    window.FloridaAlignment.trackContactFormSubmission(formData);
                }
                
                // Open email client
                window.location.href = mailtoUrl;
                
                // Show success message
                showNotification('Opening your email client. Please send the pre-filled email to complete your request.', 'success');
                
                // Optionally reset form after a delay
                setTimeout(() => {
                    if (confirm('Email client opened. Would you like to clear the form?')) {
                        contactForm.reset();
                    }
                }, 2000);
                
            } catch (error) {
                console.error('Form submission error:', error);
                showNotification('There was an error. Please try again or call us directly at (727) 358-1710.', 'danger');
            } finally {
                // Reset button after a short delay
                setTimeout(() => {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }, 1500);
            }
        });
    }
});

function validateContactForm() {
    const form = document.getElementById('contact-form');
    const requiredFields = form.querySelectorAll('[required]');
    let isValid = true;
    
    requiredFields.forEach(field => {
        if (!validateField(field)) {
            isValid = false;
        }
    });
    
    return isValid;
}

function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 1050; min-width: 350px; max-width: 500px;';
    notification.innerHTML = `
        <div class="d-flex align-items-center">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
            <div class="flex-grow-1">${message}</div>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    `;
    
    document.body.appendChild(notification);
    
    // Auto-remove after 7 seconds for success messages
    if (type === 'success') {
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 7000);
    }
}

// Initialize Leaflet Map with service areas
function initMap() {
    // Service areas with coordinates
    const serviceAreas = [
        { name: 'Tampa', lat: 27.9506, lng: -82.4572 },
        { name: 'St. Petersburg', lat: 27.7676, lng: -82.6403 },
        { name: 'Clearwater', lat: 27.9659, lng: -82.8001 },
        { name: 'Largo', lat: 27.9095, lng: -82.7873 },
        { name: 'Brandon', lat: 27.9378, lng: -82.2859 },
        { name: 'Wesley Chapel', lat: 28.2397, lng: -82.3276 },
        { name: 'Land O\' Lakes', lat: 28.2189, lng: -82.4576 },
        { name: 'Temple Terrace', lat: 28.0353, lng: -82.3898 },
        { name: 'Lutz', lat: 28.1539, lng: -82.4612 },
        { name: 'Oldsmar', lat: 28.0420, lng: -82.6626 },
        { name: 'Valrico', lat: 27.9389, lng: -82.2379 },
        { name: 'Palm Harbor', lat: 28.0784, lng: -82.7626 },
        { name: 'Apollo Beach', lat: 27.7731, lng: -82.4079 },
        { name: 'Sarasota', lat: 27.3364, lng: -82.5307 }
    ];
    
    // Initialize map centered on Tampa Bay area
    const map = L.map('google-map', {
        scrollWheelZoom: false,
        dragging: false,
        zoomControl: false,
        doubleClickZoom: false,
        boxZoom: false,
        keyboard: false,
        tap: false
    });
    
    // Add OpenStreetMap tiles
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; OpenStreetMap contributors',
        maxZoom: 19
    }).addTo(map);
    
    // Calculate bounds from service areas
    const bounds = [];
    serviceAreas.forEach(area => {
        bounds.push([area.lat, area.lng]);
    });
    
    // Fit map to show all service areas
    if (bounds.length > 0) {
        map.fitBounds(bounds, { padding: [30, 30] });
    }
}

// Load map when page loads
document.addEventListener('DOMContentLoaded', function() {
    if (document.getElementById('google-map')) {
        // Small delay to ensure DOM is ready
        setTimeout(initMap, 100);
    }
});
</script>
{% endblock %}
